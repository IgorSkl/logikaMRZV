###############################################################################
#
# IAR ANSI C/C++ Compiler V7.40.2.8542/W32 for ARM        20/Oct/2015  12:49:38
# Copyright 1999-2015 IAR Systems AB.
#
#    Cpu mode     =  arm
#    Endian       =  little
#    Source file  =  
#        D:\IAR projects\HR1_0100_00_I720_new2\component\logicMTZ2to5.c
#    Command line =  
#        "D:\IAR projects\HR1_0100_00_I720_new2\component\logicMTZ2to5.c" -D
#        _STATIC_MEMORY_BOOT -lcN "D:\IAR
#        projects\HR1_0100_00_I720_new2\EWP\Debug xFlash\List\" -o "D:\IAR
#        projects\HR1_0100_00_I720_new2\EWP\Debug xFlash\Obj\" --debug
#        --endian=little --cpu=ARM926EJ-S -e --fpu=VFP9-S --dlib_config
#        "C:\Program Files\IAR Systems\Embedded Workbench
#        7.40\arm\INC\c\DLib_Config_Normal.h" -I "D:\IAR
#        projects\HR1_0100_00_I720_new2\EWP\..\NXP\" -I "D:\IAR
#        projects\HR1_0100_00_I720_new2\EWP\..\LIB\include\" -I "D:\IAR
#        projects\HR1_0100_00_I720_new2\EWP\..\inc\" -I "D:\IAR
#        projects\HR1_0100_00_I720_new2\EWP\..\Igor\" -I "D:\IAR
#        projects\HR1_0100_00_I720_new2\EWP\..\mal\" -I "D:\IAR
#        projects\HR1_0100_00_I720_new2\EWP\..\component\" -I "D:\IAR
#        projects\HR1_0100_00_I720_new2\EWP\..\psupervisor\" -I "D:\IAR
#        projects\HR1_0100_00_I720_new2\EWP\..\virtualMenu\" -I "D:\IAR
#        projects\HR1_0100_00_I720_new2\EWP\..\callbackElement\" -I "D:\IAR
#        projects\HR1_0100_00_I720_new2\EWP\..\logictimers\" -I "D:\IAR
#        projects\HR1_0100_00_I720_new2\EWP\..\zonaVRT\" -I "D:\IAR
#        projects\HR1_0100_00_I720_new2\EWP\..\" --cpu_mode arm -Ohs
#        --use_c++_inline
#    List file    =  
#        D:\IAR projects\HR1_0100_00_I720_new2\EWP\Debug
#        xFlash\List\logicMTZ2to5.lst
#    Object file  =  
#        D:\IAR projects\HR1_0100_00_I720_new2\EWP\Debug
#        xFlash\Obj\logicMTZ2to5.o
#
###############################################################################

D:\IAR projects\HR1_0100_00_I720_new2\component\logicMTZ2to5.c
      1          
      2          #include <stdio.h>
      3          #include <string.h>
      4          
      5          #include "bazisdef.h"
      6          #include "component\componentdef.h"
      7          #include "psuperVisor\psvisor_helpdef.h"
      8          
      9          #include "logictimers\logictimersmac.h"
     10          
     11          #include "logictimers\logictimersfnc.h"
     12          
     13          #include "..\bazis.h"
     14          
     15          #include "toSpeedOptim.h"
     16          
     17          #define _HIDE_COMPONENT
     18          #include "PRM1Component.c"
     19          #include "MTZ2Component.c"
     20          
     21          extern int GlobalPO1;//телеметрия
     22          extern int GlobalPO2;//телеметрия
     23          extern int GlobalPO3;//телеметрия
     24          extern int GlobalPO4;//телеметрия
     25          extern int GlobalLevelI_ABC[];//действ значения 3 фаз токов
     26          extern int GlobalLevelUL_ABC[];//действ значения 3 фаз напр
     27          //сектора направл МТЗ
     28          extern int sectorMTZ_IA_V, sectorMTZ_IA_N;
     29          extern int sectorMTZ_IB_V, sectorMTZ_IB_N;
     30          extern int sectorMTZ_IC_V, sectorMTZ_IC_N;
     31          
     32          extern COMPONENT_OBJ  cnfCOMPONENT[];//конфигурация
     33          extern int  logMassTimer[];
     34          extern int  ENAcmd[];
     35          extern int offsetIOCmdPRM1;//смещение для IO PRM1
     36          extern int  spvUSTAVKI[];//текущие уставки супервизора
     37          extern int   WideCmdRTBuffer[];
     38          extern int   tempLog[];
     39          //неисправность цепей напр 
     40          extern int  isFAILU_COMMON_MTZ;
     41          extern int offsetSPVCmdPRM1;//смещение для SPV PRM1
     42          
     43          extern int flag_max_monitoring;//макс параметры сработки
     44          
     45          void  logicMTZ2to5(int idxC) @ "Fast_function"
     46          {
     47          //логика компонента
     48          
     49            int tmpOffsetT    =
     50              cnfCOMPONENT[idxC].offsetTimers;   //таймера компонента в конфигурации
     51            int tmpOffsetIO   =
     52              cnfCOMPONENT[idxC].offsetIOCmd;    //IO команды
     53            int tmpOffsetENA  =
     54              cnfCOMPONENT[idxC].offsetENACmd;   //ENA команды
     55            int tmpOffsetTL   =
     56              cnfCOMPONENT[idxC].offsetTLCmd;    //TL команды
     57            int tmpOffsetUSpv =
     58              cnfCOMPONENT[idxC].offsetUstSpv;    //уставки SPV
     59          
     60          
     61            detectorLevelUP3F(GlobalLevelI_ABC, tmpOffsetUSpv+SPVSRABUST_MTZ2to5,
     62                                                tmpOffsetUSpv+SPVVOZVUST_MTZ2to5,
     63                                                tmpOffsetUSpv+SPV_OUTA_MTZ2to5);
     64          
     65           //локальное ПО канала MTZ2to5
     66           int LocalPO_MTZ2to5 = SPV_UST(SPV_OUTA_MTZ2to5) |
     67                                 SPV_UST(SPV_OUTB_MTZ2to5) |
     68                                 SPV_UST(SPV_OUTC_MTZ2to5);
     69          
     70          //неисправность цепей напр 
     71          
     72            detectorLevelUP3F(GlobalLevelI_ABC, tmpOffsetUSpv+SPVSRABUST_MTZ2to5_V,
     73                                                tmpOffsetUSpv+SPVVOZVUST_MTZ2to5_V,
     74                                                tmpOffsetUSpv+SPV_OUTA_MTZ2to5_V);
     75          
     76           //локальное ПО канала MTZ2to5_V
     77           int LocalPO_MTZ2to5_V = (
     78          	                 (sectorMTZ_IA_V & 
     79                                    SPV_UST(SPV_OUTA_MTZ2to5_V) &
     80                                    (SPV_USTOUT(offsetSPVCmdPRM1+SPV_OUTA_U005)^1)
     81                                    ) |
     82          	                 (sectorMTZ_IB_V &
     83                                    SPV_UST(SPV_OUTB_MTZ2to5_V) &
     84                                    (SPV_USTOUT(offsetSPVCmdPRM1+SPV_OUTB_U005)^1)
     85                                    )|
     86          	                 (sectorMTZ_IC_V &
     87                                    SPV_UST(SPV_OUTC_MTZ2to5_V) &
     88                                    (SPV_USTOUT(offsetSPVCmdPRM1+SPV_OUTC_U005)^1)
     89                                    )
     90                                    );
     91          
     92          
     93            detectorLevelUP3F(GlobalLevelI_ABC, tmpOffsetUSpv+SPVSRABUST_MTZ2to5_N,
     94                                                tmpOffsetUSpv+SPVVOZVUST_MTZ2to5_N,
     95                                                tmpOffsetUSpv+SPV_OUTA_MTZ2to5_N);
     96          
     97           //локальное ПО канала MTZ2to5_N
     98           int LocalPO_MTZ2to5_N = (
     99          	                 (sectorMTZ_IA_N & 
    100                                    SPV_UST(SPV_OUTA_MTZ2to5_N) &
    101                                    (SPV_USTOUT(offsetSPVCmdPRM1+SPV_OUTA_U005)^1)
    102                                    ) |
    103          	                 (sectorMTZ_IB_N &
    104                                    SPV_UST(SPV_OUTB_MTZ2to5_N) &
    105                                    (SPV_USTOUT(offsetSPVCmdPRM1+SPV_OUTB_U005)^1)
    106                                    )|
    107          	                 (sectorMTZ_IC_N &
    108                                    SPV_UST(SPV_OUTC_MTZ2to5_N) &
    109                                    (SPV_USTOUT(offsetSPVCmdPRM1+SPV_OUTC_U005)^1)
    110                                    )
    111                                    );
    112          
    113          //MTZ2to5PN
    114          //токи
    115            detectorLevelUP3F(GlobalLevelI_ABC, 
    116                                               tmpOffsetUSpv+SPVSRABUST_MTZ2to5_PN,
    117                                               tmpOffsetUSpv+SPVVOZVUST_MTZ2to5_PN,
    118                                               tmpOffsetUSpv+SPV_OUTA_MTZ2to5_PN);
    119          
    120          
    121          //напряж
    122            detectorLevelDOWN3F(GlobalLevelUL_ABC,
    123                                               tmpOffsetUSpv+SPVSRABUST_MTZ2to5_UPN,
    124                                               tmpOffsetUSpv+SPVVOZVUST_MTZ2to5_UPN,
    125                                               tmpOffsetUSpv+SPV_OUTA_MTZ2to5_UPN);
    126          
    127          
    128          //если одно из напряжений UA UB UC больше уставки то MTZ2to5_PN запрещается
    129           int LocalPO_MTZ2to5_PN = (
    130                                    (SPV_UST(SPV_OUTA_MTZ2to5_PN) &
    131                                     SPV_UST(SPV_OUTA_MTZ2to5_UPN)) |
    132                                    (SPV_UST(SPV_OUTB_MTZ2to5_PN) &
    133                                     SPV_UST(SPV_OUTB_MTZ2to5_UPN)) |
    134                                    (SPV_UST(SPV_OUTC_MTZ2to5_PN) &
    135                                     SPV_UST(SPV_OUTC_MTZ2to5_UPN))
    136                                    );
    137          
    138          #include "inc_uskmtz2.ci"
    139          #include "inc_uskmtz2_v.ci"
    140          #include "inc_uskmtz2_n.ci"
    141          #include "inc_uskmtz2_pn.ci"
    142          
    143          
    144            //*******MTZ2********
    145            int commonMTZ2to5 =
    146              //CMD_MTZ2to5
    147              (IO_LOGIC(IOCMD1_MTZ2to5)^1) &
    148              ENA_LOGIC(ENA1_MTZ2to5);
    149          
    150             int locPO_MTZ2to5 = 
    151                  commonMTZ2to5 &
    152                  //ПО МТЗ2
    153                  (GlobalPO1 | LocalPO_MTZ2to5)&
    154                  //MTZ2to5_PROSTAJA
    155                  (((ENA_LOGIC(ENA_MTZ2to5_HALF1) |
    156                    ENA_LOGIC(ENA_MTZ2to5_HALF2))^1) |
    157                           //разрешить если все UL меньше 005
    158                            (
    159                               SPV_USTOUT(offsetSPVCmdPRM1+SPV_OUTA_U005) &
    160                               SPV_USTOUT(offsetSPVCmdPRM1+SPV_OUTB_U005) &
    161                               SPV_USTOUT(offsetSPVCmdPRM1+SPV_OUTC_U005)
    162                             ) |
    163                           //разрешить если НЦН
    164                  //ELOUTTRG_NCN_MTZ2to5
    165                  TL_LOGIC(TLCMDOUTNCN_MTZ2to5)
    166                            );
    167          
    168             int locPO_MTZ2to5_V = 
    169                  commonMTZ2to5 &
    170                  //ПО МТЗ2 ВПД
    171                  (GlobalPO2 | LocalPO_MTZ2to5_V)&
    172                  //MTZ2to5_NAPRAVL
    173                  ENA_LOGIC(ENA_MTZ2to5_HALF1) &
    174                  //MTZ2to5 WPERED
    175                  ENA_LOGIC(ENA2_MTZ2to5) &
    176                  //ELOUTTRG_NCN_MTZ2to5
    177                  (TL_LOGIC(TLCMDOUTNCN_MTZ2to5)^1);
    178          
    179             int locPO_MTZ2to5_N = 
    180                  commonMTZ2to5 &
    181                  //ПО МТЗ2 НЗД
    182                  (GlobalPO3 | LocalPO_MTZ2to5_N)&
    183                  //MTZ1_NAPRAVL
    184                  ENA_LOGIC(ENA_MTZ2to5_HALF1) &
    185                  //MTZ1 NAZAD
    186                  ENA_LOGIC(ENA3_MTZ2to5) &
    187                  //ELOUTTRG_NCN_MTZ2to5
    188                  (TL_LOGIC(TLCMDOUTNCN_MTZ2to5)^1);
    189          
    190             int locPO_MTZ2to5_PN = 
    191                  commonMTZ2to5 &
    192                  //ПО МТЗ2 ПН
    193                  (GlobalPO4 | LocalPO_MTZ2to5_PN)&
    194                  //MTZ2to5_PUSKN
    195                  ENA_LOGIC(ENA_MTZ2to5_HALF2) &
    196                  //ELOUTTRG_NCN_MTZ2to5
    197                  (TL_LOGIC(TLCMDOUTNCN_MTZ2to5)^1);
    198          
    199           tmp1 =
    200              locPO_MTZ2to5_V  |
    201              locPO_MTZ2to5_N  |
    202              locPO_MTZ2to5_PN; 
    203          
    204          //триг по восх фронту
    205          //TRG_FRONT(set, clr, old, out)
    206          //                                    ELOLDTRG_NCN_MTZ2to5  ELOUTTRG_NCN_MTZ2to5
    207            TRG_FRONT(tmp1, isFAILU_COMMON_MTZ, TLCMDOLDNCN_MTZ2to5, TLCMDOUTNCN_MTZ2to5)
    208          
    209            locPO_MTZ2to5_V &=
    210                  //ELOUTTRG_NCN_MTZ2to5
    211                  (TL_LOGIC(TLCMDOUTNCN_MTZ2to5)^1);
    212          
    213            locPO_MTZ2to5_N &=
    214                  //ELOUTTRG_NCN_MTZ2to5
    215                  (TL_LOGIC(TLCMDOUTNCN_MTZ2to5)^1);
    216          
    217            locPO_MTZ2to5_PN &=
    218                  //ELOUTTRG_NCN_MTZ2to5
    219                  (TL_LOGIC(TLCMDOUTNCN_MTZ2to5)^1);
    220          
    221             int max_tmp = 
    222             tmp1 =
    223              //L1
    224              //MTZ2to5_PO1
    225              TL_LOGIC(TLCMD5_MTZ2to5) =
    226                //Сраб ПО МТЗ2
    227                //CMD_MTZ2to5_PO1
    228                IO_LOGIC(IOCMD4_MTZ2to5) =
    229                locPO_MTZ2to5;
    230          
    231              if(max_tmp) flag_max_monitoring |= MAXMONITORING_COLLECT;//макс параметры сработки
    232          
    233            //L5
    234          //  int tmp =
    235               //MTZ2to5_TIM1
    236            LSIGNAL_TIMER(TIMER1_MTZ2to5)  = 
    237              //RES_MTZ2to5
    238              TL_LOGIC(TLCMD1_MTZ2to5) & tmp1;
    239          
    240            //дельта таймера MTZ2to5_TIM1
    241            TL_LOGIC(TL10_MTZ2TO5) = IS_TIMER_DELTA12(TIMER1_MTZ2to5)^1;   
    242          
    243            max_tmp = 
    244            tmp2 =
    245              //L2
    246              //MTZ2to5_PO2
    247              TL_LOGIC(TLCMD6_MTZ2to5) =
    248                //Сраб ПО МТЗ2 ВПД
    249                //CMD_MTZ2to5_PO2
    250                IO_LOGIC(IOCMD5_MTZ2to5) =
    251                locPO_MTZ2to5_V;
    252              if(max_tmp) flag_max_monitoring |= MAXMONITORING_COLLECT;//макс параметры сработки
    253          
    254            //L6
    255            //tmp =
    256            //MTZ2to5_TIM2
    257            LSIGNAL_TIMER(TIMER2_MTZ2to5)  =
    258              //RES_MTZ2to5_V
    259              TL_LOGIC(TLCMD2_MTZ2to5) & tmp2;
    260          
    261            //проверка таймера MTZ2to5_TIM2
    262            TL_LOGIC(TL10_MTZ2TO5_V) = IS_TIMER_DELTA12(TIMER2_MTZ2to5)^1;   
    263          
    264            int tmp3 =
    265            max_tmp = 
    266              //L3
    267              //MTZ2to5_PO3
    268              TL_LOGIC(TLCMD7_MTZ2to5) =
    269                //Сраб ПО МТЗ2 НЗД
    270                //CMD_MTZ2to5_PO3
    271                IO_LOGIC(IOCMD6_MTZ2to5) =
    272                locPO_MTZ2to5_N;
    273              if(max_tmp) flag_max_monitoring |= MAXMONITORING_COLLECT;//макс параметры сработки
    274          
    275            //tmp =
    276            //MTZ2to5_TIM3
    277            LSIGNAL_TIMER(TIMER3_MTZ2to5)  =
    278              //RES_MTZ2to5_N
    279              TL_LOGIC(TLCMD3_MTZ2to5) & tmp3;//L7
    280          
    281            //проверка таймера MTZ2to5_TIM3
    282            TL_LOGIC(TL10_MTZ2TO5_N) = IS_TIMER_DELTA12(TIMER3_MTZ2to5)^1;   
    283          
    284            max_tmp =
    285            tmp4 =
    286              //L4
    287              //MTZ2to5_PO4
    288              TL_LOGIC(TLCMD8_MTZ2to5) =
    289                //Сраб ПО МТЗ2 ПН
    290                //CMD_MTZ2to5_PO4
    291                IO_LOGIC(IOCMD7_MTZ2to5) =
    292                locPO_MTZ2to5_PN;
    293              if(max_tmp) flag_max_monitoring |= MAXMONITORING_COLLECT;//макс параметры сработки
    294          
    295            //tmp =
    296            //MTZ2to5_TIM4
    297            LSIGNAL_TIMER(TIMER4_MTZ2to5)  =
    298              //RES_MTZ2to5_PN
    299              TL_LOGIC(TLCMD4_MTZ2to5) & tmp4;//L8
    300          
    301            //проверка таймера MTZ2to5_TIM4
    302            TL_LOGIC(TL10_MTZ2TO5_PN) = IS_TIMER_DELTA12(TIMER4_MTZ2to5)^1;   
    303          
    304            //L9
    305            tmp1 = 
    306                   PLOG_TIMER(TIMER1_MTZ2to5)| //MTZ2to5_TIM1
    307                   PLOG_TIMER(TIMER2_MTZ2to5)| //MTZ2to5_TIM2
    308                   PLOG_TIMER(TIMER3_MTZ2to5)| //MTZ2to5_TIM3
    309                   PLOG_TIMER(TIMER4_MTZ2to5); //MTZ2to5_TIM4
    310          
    311            //L10
    312            int tmp = LSIGNAL_TIMER(TIMER_BO_MTZ2to5)  =
    313                        //MTZ2to5_USKOR
    314                        TL_LOGIC(TLCMD15_MTZ2to5) |
    315                        //MTZ2to5_V_USKOR
    316                        TL_LOGIC(TLCMD15_MTZ2to5_V) |
    317                        //MTZ2to5_N_USKOR
    318                        TL_LOGIC(TLCMD15_MTZ2to5_N) |
    319                        //MTZ2to5_PN_USKOR
    320                        TL_LOGIC(TLCMD15_MTZ2to5_PN) |
    321                        tmp1;
    322          
    323            max_tmp =
    324            //Сраб МТЗ2
    325            //CMD_MTZ2to5
    326            IO_LOGIC(IOCMD8_MTZ2to5) =
    327              ILOG_TIMER(TIMER_BO_MTZ2to5)|tmp;
    328              if(max_tmp) flag_max_monitoring |= MAXMONITORING_FIX;//макс параметры сработки
    329          
    330          }//logicMTZ2to5(short idxC)

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
      80   logicMTZ2to5
        80   -> FLogTimer
        80   -> ILogTimer
        80   -> PLogTimer
        80   -> detectorLevelDOWN3F
        80   -> detectorLevelUP3F
        80   -> isTimerDelta


   Section sizes:

   Bytes  Function/Label
   -----  --------------
    2992  logicMTZ2to5

 
 2 992 bytes in section Fast_function
 
 2 992 bytes of CODE memory

Errors: none
Warnings: none
